using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Xml;
using CSKernelClient;

namespace CSReportDll
{

    public class cReportGroup
    {
        private const String C_HEADER = "H";
        private const String C_FOOTER = "F";

        private cReportSection m_header;
        private cReportSection m_footer;
        private int m_index = 0;

        private String m_name = "";

        private csRptGrpOrderType m_oderType;
        private csRptGrpComparisonType m_comparisonType;

        // to print in a new page when the group change
        //
        private bool m_printInNewPage;
        
        // to reprint group headers in every new page
        //
        private bool m_rePrintInNewPage;
        private bool m_grandTotalGroup;
        private String m_fieldName = "";
        private String m_key = "";

        public cReportSection getHeader()
        {
            return m_header;
        }

        public void setHeader(cReportSection rhs)
        {
            m_header = rhs;
        }

        public cReportSection getFooter()
        {
            return m_footer;
        }

        public void setFooter(cReportSection rhs)
        {
            m_footer = rhs;
        }

        public int getIndex()
        {
            return m_index;
        }

        public void setIndex(int rhs)
        {
            m_index = rhs;
        }

        public csRptGrpOrderType getOderType()
        {
            return m_oderType;
        }

        public void setOderType(csRptGrpOrderType rhs)
        {
            m_oderType = rhs;
        }

        public csRptGrpComparisonType getComparisonType()
        {
            return m_comparisonType;
        }

        public void setComparisonType(csRptGrpComparisonType rhs)
        {
            m_comparisonType = rhs;
        }

        public bool getPrintInNewPage()
        {
            return m_printInNewPage;
        }

        public void setPrintInNewPage(bool rhs)
        {
            m_printInNewPage = rhs;
        }

        public bool getRePrintInNewPage()
        {
            return m_rePrintInNewPage;
        }

        public void setRePrintInNewPage(bool rhs)
        {
            m_rePrintInNewPage = rhs;
        }

        public bool getGrandTotalGroup()
        {
            return m_grandTotalGroup;
        }

        public void setGrandTotalGroup(bool rhs)
        {
            m_grandTotalGroup = rhs;
        }

        public String getFieldName()
        {
            return m_fieldName;
        }

        public void setFieldName(String rhs)
        {
            m_fieldName = rhs;
        }

        public String getName()
        {
            return m_name;
        }

        public void setName(String rhs)
        {
            m_name = rhs;
        }

        public String getKey()
        {
            return m_key;
        }

        public void setKey(String rhs)
        {
            m_key = rhs;
        }

        internal bool load(CSXml.cXml xDoc, XmlElement nodObj)
        {
            m_name = xDoc.getNodeProperty(nodObj, "Name").getValueString(eTypes.eText);
            m_index = xDoc.getNodeProperty(nodObj, "Indice").getValueInt(eTypes.eInteger);
            m_comparisonType = (csRptGrpComparisonType)xDoc.getNodeProperty(nodObj, "ComparisonType").getValueInt(eTypes.eInteger);
            m_fieldName = xDoc.getNodeProperty(nodObj, "FieldName").getValueString(eTypes.eText);
            m_oderType = (csRptGrpOrderType)xDoc.getNodeProperty(nodObj, "OderType").getValueInt(eTypes.eInteger);
            m_printInNewPage = xDoc.getNodeProperty(nodObj, "PrintInNewPage").getValueBool(eTypes.eBoolean);
            m_rePrintInNewPage = xDoc.getNodeProperty(nodObj, "RePrintInNewPage").getValueBool(eTypes.eBoolean);
            m_grandTotalGroup = xDoc.getNodeProperty(nodObj, "GrandTotalGroup").getValueBool(eTypes.eBoolean);

            pSetName();

            XmlElement nodObjAux = null;

            nodObjAux = nodObj;
            nodObjAux = xDoc.getNodeFromNode(nodObj, C_HEADER);
            nodObjAux = xDoc.getNodeChild(nodObjAux);
            if (!m_header.load(xDoc, nodObjAux)) 
            { 
                return false; 
            }

            m_header.setName(m_name);

            nodObjAux = nodObj;
            nodObjAux = xDoc.getNodeFromNode(nodObj, C_FOOTER);
            nodObjAux = xDoc.getNodeChild(nodObjAux);
            if (!m_footer.load(xDoc, nodObjAux)) 
            { 
                return false; 
            }

            m_footer.setName(m_name);

            return true;
        }

        private void pSetName()
        {
            if (m_name.ToLower().Substring(0, 5) == "group" 
                || m_name.ToLower().Substring(0, 5) == "grupo" 
                || m_name.ToLower().Substring(0, 3) == "gh_" 
                || m_name.ToLower().Substring(0, 3) == "gf_" 
                || m_name.ToLower().Substring(0, 2) == "g_" 
                || m_name.Length == 0)
            {
                m_name = "G_" + m_index;
            }

        }

        internal bool save(CSXml.cXml xDoc, XmlElement nodeFather)
        {
            CSXml.cXmlProperty xProperty = null;
            XmlElement nodObj = null;

            xProperty = new CSXml.cXmlProperty();

            xProperty.setName(m_name);
            nodObj = xDoc.addNodeToNode(nodeFather, xProperty);

            xProperty.setName("Key");
            xProperty.setValue(eTypes.eText, m_key);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("Name");
            xProperty.setValue(eTypes.eText, m_name);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("Indice");
            xProperty.setValue(eTypes.eInteger, m_index);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("ComparisonType");
            xProperty.setValue(eTypes.eInteger, m_comparisonType);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("FieldName");
            xProperty.setValue(eTypes.eText, m_fieldName);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("OderType");
            xProperty.setValue(eTypes.eInteger, m_oderType);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("PrintInNewPage");
            xProperty.setValue(eTypes.eBoolean, m_printInNewPage);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("RePrintInNewPage");
            xProperty.setValue(eTypes.eBoolean, m_rePrintInNewPage);
            xDoc.addPropertyToNode(nodObj, xProperty);

            xProperty.setName("GrandTotalGroup");
            xProperty.setValue(eTypes.eBoolean, m_grandTotalGroup);
            xDoc.addPropertyToNode(nodObj, xProperty);

            XmlElement nodObjAux = null;
            nodObjAux = nodObj;
            xProperty.setName(C_HEADER);
            nodObjAux = xDoc.addNodeToNode(nodObjAux, xProperty);
            m_header.save(xDoc, nodObjAux);

            nodObjAux = nodObj;
            xProperty.setName(C_FOOTER);
            nodObjAux = xDoc.addNodeToNode(nodObjAux, xProperty);
            m_footer.save(xDoc, nodObjAux);

            return true;

        }

    }

}
